<% content_for :title, "我的书架" %>

<div class="min-h-screen bg-gradient-to-br from-amber-50 to-orange-50 dark:from-gray-900 dark:to-gray-800 py-8">
  <div class="container-xl mx-auto px-4">
    
    <!-- Top Action Buttons (Fixed Position) -->
    <div class="fixed top-6 right-6 z-40 flex gap-3">
      <%= link_to articles_path, class: "btn-secondary shadow-lg hover:shadow-xl transition-all" do %>
        <%= lucide_icon "arrow-left", class: "w-5 h-5 inline-block mr-2" %>
        返回主页
      <% end %>
      <%= link_to new_my_book_path, class: "btn-primary shadow-lg hover:shadow-xl transition-all" do %>
        <%= lucide_icon "plus", class: "w-5 h-5 inline-block mr-2" %>
        新建书籍
      <% end %>
    </div>

    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-50 flex items-center gap-3">
        <%= lucide_icon "book", class: "w-8 h-8" %>
        我的书籍
      </h1>
      <p class="text-gray-600 dark:text-gray-400 mt-2">管理你的书籍和章节</p>
    </div>


    <!-- Books Grid -->
    <% if @books.any? %>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
        <% @books.each do |book| %>
          <div class="card bg-white dark:bg-gray-800 shadow-lg hover:shadow-xl transition-all overflow-hidden">
            <!-- Book Cover -->
            <div class="relative aspect-[3/4] bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 overflow-hidden group">
              <div id="book-cover-<%= book.id %>" class="absolute inset-0 w-full h-full">
                <%= book_cover_svg(book).html_safe %>
              </div>
              
              <!-- Change Cover Button (appears on hover) -->
              <div class="absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-all duration-300 flex items-center justify-center">
                <%= button_to change_cover_my_book_path(book), method: :patch, 
                    class: "btn-secondary btn-sm opacity-0 group-hover:opacity-100 transition-opacity duration-300",
                    data: { turbo_method: :patch } do %>
                  <%= lucide_icon "shuffle", class: "w-4 h-4 mr-1" %>
                  更换封皮
                <% end %>
              </div>
              
              <!-- Pinned Badge -->
              <% if book.pinned %>
                <div class="absolute top-3 right-3 bg-yellow-500 text-white px-2 py-1 rounded-full text-xs font-bold flex items-center gap-1">
                  <%= lucide_icon "pin", class: "w-3 h-3" %>
                  置顶
                </div>
              <% end %>
              
              <!-- Status Badge -->
              <div class="absolute bottom-3 left-3">
                <span class="badge <%= book.status == 'published' ? 'badge-success' : 'badge-warning' %>">
                  <%= book.status == 'published' ? '已发布' : '草稿' %>
                </span>
              </div>
            </div>
            
            <!-- Book Info -->
            <div class="card-body p-4">
              <h3 class="font-bold text-lg text-gray-900 dark:text-gray-50 mb-1 line-clamp-2">
                <%= book.title %>
              </h3>
              
              <% if book.subtitle.present? %>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-2 line-clamp-1">
                  <%= book.subtitle %>
                </p>
              <% end %>
              
              <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400 mb-3">
                <div class="flex items-center gap-4">
                  <span class="flex items-center gap-1">
                    <%= lucide_icon "folder", class: "w-4 h-4" %>
                    <%= book.chapters.count %> 章
                  </span>
                  <span class="flex items-center gap-1">
                    <%= lucide_icon "file-text", class: "w-4 h-4" %>
                    <%= book.articles_count %> 篇
                  </span>
                  <span class="flex items-center gap-1">
                    <%= lucide_icon "type", class: "w-4 h-4" %>
                    <%= number_with_delimiter(book.total_word_count) %> 字
                  </span>
                </div>
              </div>
              
              <!-- Action Buttons -->
              <div class="flex gap-2">
                <%= link_to my_book_path(book), class: "btn-primary btn-sm flex-1" do %>
                  <%= lucide_icon "book-open", class: "w-4 h-4 mr-1" %>
                  阅读
                <% end %>
                <%= link_to edit_my_book_path(book), class: "btn-ghost btn-sm" do %>
                  <%= lucide_icon "edit", class: "w-4 h-4" %>
                <% end %>
                <%= link_to my_book_path(book), method: :delete, 
                    data: { confirm: "确定要删除《#{book.title}》吗？" },
                    class: "btn-ghost btn-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20" do %>
                  <%= lucide_icon "trash-2", class: "w-4 h-4" %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      
      <!-- Pagination -->
      <div class="flex justify-center">
        <%= paginate @books, theme: 'twitter-bootstrap-4' %>
      </div>
    <% else %>
      <!-- Empty State -->
      <div class="card bg-white dark:bg-gray-800 shadow-lg">
        <div class="card-body p-12 text-center">
          <%= lucide_icon "book-open", class: "w-16 h-16 mx-auto mb-4 text-gray-400" %>
          <h3 class="text-xl font-bold text-gray-900 dark:text-gray-50 mb-2">还没有书籍</h3>
          <p class="text-gray-600 dark:text-gray-400 mb-6">
            <%= params[:search].present? ? "没有找到匹配的书籍" : "开始创建你的第一本书吧！" %>
          </p>
          <% unless params[:search].present? %>
            <%= link_to new_my_book_path, class: "btn-primary" do %>
              <%= lucide_icon "plus", class: "w-5 h-5 mr-2" %>
              新建书籍
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>

  </div>
</div>
