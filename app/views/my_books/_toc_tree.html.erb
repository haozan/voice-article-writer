<% chapters.each do |chapter| %>
  <div class="<%= 'ml-4' if chapter.level > 1 %>">
    <div class="flex items-start gap-1 py-2 px-3 rounded-lg text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors <%= 'font-semibold' if chapter.level == 1 %>">
      <!-- Toggle button for chapters with sub-chapters -->
      <% if chapter.sub_chapters.any? %>
        <button class="flex-shrink-0 w-4 h-4 flex items-center justify-center"
                data-action="click->book-chapters#toggleChapter"
                data-chapter-id="<%= chapter.id %>">
          <%= lucide_icon "chevron-right", class: "w-4 h-4 transition-transform", 
                          data: { toc_toggle: chapter.id } %>
        </button>
      <% else %>
        <div class="w-4 h-4 flex-shrink-0"></div>
      <% end %>
      
      <!-- Chapter link -->
      <a href="#chapter-<%= chapter.id %>" class="flex-1 flex items-center gap-2">
        <span class="flex-1"><%= chapter.title %></span>
        <% if chapter.articles.any? %>
          <span class="text-xs text-gray-500 dark:text-gray-400">
            <%= chapter.articles.count %>
          </span>
        <% end %>
      </a>
    </div>
    
    <!-- Sub-chapters (collapsible) -->
    <% if chapter.sub_chapters.any? %>
      <div class="hidden" data-toc-content="<%= chapter.id %>">
        <%= render partial: 'my_books/toc_tree', locals: { chapters: chapter.sub_chapters } %>
      </div>
    <% end %>
  </div>
<% end %>
