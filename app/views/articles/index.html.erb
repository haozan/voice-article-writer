<div class="min-h-screen bg-gradient-to-br from-primary/5 via-surface to-secondary/5 py-8 px-4">
  <div 
    class="container-lg mx-auto max-w-4xl"
    data-controller="articles" 
    data-articles-stream-name-value="<%= @stream_name %>"
  >
    <!-- Header -->
    <div class="mb-8">
      <div class="text-center mb-3 lg:relative">
        <h1 class="text-4xl lg:text-5xl font-bold text-primary mb-4 lg:mb-0">
          最小阻力写作
        </h1>
        <!-- Desktop: buttons on title row -->
        <div class="hidden lg:flex lg:absolute lg:right-0 lg:top-0 gap-3">
          <% if params[:article_id].present? %>
            <%= link_to root_path, class: "btn-secondary" do %>
              <%= lucide_icon "arrow-left", class: "w-5 h-5 inline-block mr-2" %>
              返回主页
            <% end %>
          <% end %>
          <button
            type="button"
            data-action="click->articles#openHistory"
            class="btn-secondary"
          >
            <%= lucide_icon "history", class: "w-5 h-5 inline-block mr-2" %>
            历史文章
          </button>
        </div>

      <p class="text-lg text-secondary text-center mb-4">
        能说就能写，写出影响力
      </p>
      <!-- Mobile: buttons below subtitle -->
      <div class="flex justify-center gap-3 lg:hidden">
        <% if params[:article_id].present? %>
          <%= link_to root_path, class: "btn-secondary" do %>
            <%= lucide_icon "arrow-left", class: "w-5 h-5 inline-block mr-2" %>
            返回主页
          <% end %>
        <% end %>
        <button
          type="button"
          data-action="click->articles#openHistory"
          class="btn-secondary"
        >
          <%= lucide_icon "history", class: "w-5 h-5 inline-block mr-2" %>
          历史文章
        </button>
      </div>
    </div>

    <!-- Main Content Wrapper -->
    <div
    >
      
      <!-- Step 1: Input Section -->
      <h2 class="text-2xl font-bold text-primary mb-4 flex items-center gap-2">
        <%= lucide_icon "sparkles", class: "w-6 h-6" %>
        步骤 1：输入你的想法
      </h2>
      
      <div class="card card-elevated p-6 mb-6 rounded-none">
        <div class="mb-4">
          <label class="block text-lg font-semibold text-primary mb-3 flex items-center gap-2">
            <%= lucide_icon "message-square", class: "w-6 h-6" %>
            想法输入
          </label>
          <textarea
            data-articles-target="inputText"
            class="w-full px-4 py-3 text-lg border-2 border-border rounded-none focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all resize-none text-foreground bg-surface"
            rows="8"
            placeholder="💡 建议使用语音输入法（推荐豆包语音输入法）

在手机上说出来、讲出来：
• 你的感受和思考
• 你的思路和观点  
• 读后感和心得
• 个人经历和故事

能说就能写，让表达更自然"
          ></textarea>
        </div>
        
        <!-- Thinking Framework Selection -->
        <div class="mb-6">
          <label class="block text-lg font-semibold text-primary mb-3">
            <%= lucide_icon "brain-circuit", class: "w-5 h-5 inline-block mr-2" %>
            思考框架
          </label>
          <div class="flex flex-wrap gap-3">
            <!-- 原汁原味 (可用) -->
            <label class="relative cursor-pointer">
              <input
                type="radio"
                name="thinking_framework"
                value="original"
                data-articles-target="thinkingFramework"
                class="peer sr-only"
                checked
              />
              <div class="px-4 py-2.5 border-2 rounded-none transition-all peer-checked:border-primary peer-checked:bg-primary/10 peer-checked:shadow-md border-border bg-surface hover:border-primary/50">
                <span class="text-base font-medium text-foreground">原汁原味</span>
              </div>
            </label>

            <!-- 见感思行 (禁用) -->
            <label class="relative opacity-50 cursor-not-allowed">
              <input
                type="radio"
                name="thinking_framework"
                value="experience"
                disabled
                class="peer sr-only"
              />
              <div class="px-4 py-2.5 border-2 rounded-none border-border bg-surface">
                <span class="text-base text-muted">见感思行</span>
                <span class="ml-2 text-xs px-2 py-0.5 bg-muted/20 text-muted rounded-none">即将推出</span>
              </div>
            </label>

            <!-- 黄金圈 (禁用) -->
            <label class="relative opacity-50 cursor-not-allowed">
              <input
                type="radio"
                name="thinking_framework"
                value="golden_circle"
                disabled
                class="peer sr-only"
              />
              <div class="px-4 py-2.5 border-2 rounded-none border-border bg-surface">
                <span class="text-base text-muted">黄金圈</span>
                <span class="ml-2 text-xs px-2 py-0.5 bg-muted/20 text-muted rounded-none">即将推出</span>
              </div>
            </label>

            <!-- 口语化写作 (禁用) -->
            <label class="relative opacity-50 cursor-not-allowed">
              <input
                type="radio"
                name="thinking_framework"
                value="colloquial"
                disabled
                class="peer sr-only"
              />
              <div class="px-4 py-2.5 border-2 rounded-none border-border bg-surface">
                <span class="text-base text-muted">口语化写作</span>
                <span class="ml-2 text-xs px-2 py-0.5 bg-muted/20 text-muted rounded-none">即将推出</span>
              </div>
            </label>
          </div>
        </div>
        
        <div class="text-center">
          <button
            type="button"
            data-action="click->articles#generateArticle"
            class="btn-primary btn-lg px-12"
          >
            <%= lucide_icon "sparkles", class: "w-5 h-5 inline-block mr-2" %>
            开始对话
          </button>
        </div>

      </div>

      <!-- Step 2: Multi-Model Response Section -->
      <div data-articles-target="responsesContainer" style="display: none;">
        <h2 class="text-2xl font-bold text-primary mb-4 flex items-center gap-2">
          <%= lucide_icon "sparkles", class: "w-6 h-6" %>
          步骤 2：AI 模型回应
        </h2>
        
        <!-- Grok Response -->
        <div class="card card-elevated mb-4 bg-gradient-to-br from-primary/5 to-secondary/5 rounded-none">
          <div class="card-header border-b border-border flex items-center justify-between rounded-none">
            <h3 class="text-lg font-bold text-primary flex items-center gap-2">
              <%= lucide_icon "zap", class: "w-5 h-5" %>
              Grok
              <span class="text-sm font-normal text-muted">grok-4-1-fast-reasoning</span>
            </h3>
            <div class="flex gap-2">
              <button
                type="button"
                data-action="click->articles#copyResponse"
                data-provider="grok"
                data-articles-target="copyButtonGrok"
                class="btn-primary btn-sm"
                style="display: none;"
              >
                <%= lucide_icon "copy", class: "w-4 h-4 inline-block mr-1" %>
                复制
              </button>
              <button
                type="button"
                data-action="click->articles#generateDraft"
                data-provider="grok"
                data-articles-target="draftButtonGrok"
                class="btn-success btn-sm"
                style="display: none;"
              >
                <%= lucide_icon "file-edit", class: "w-4 h-4 inline-block mr-1" %>
                生成初稿
              </button>
            </div>
          </div>
          <div class="card-body">
            <div 
              data-articles-target="responseGrok"
              class="text-secondary text-base leading-relaxed prose prose-sm max-w-none dark:prose-invert min-h-[150px] max-h-[400px] overflow-y-auto"
            >
              <div class="flex items-center gap-2 text-muted">
                <div class="loading-spinner w-4 h-4"></div>
                <span>Grok 思考中...</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Qwen Response -->
        <div class="card card-elevated mb-4 bg-gradient-to-br from-secondary/5 to-accent/5 rounded-none">
          <div class="card-header border-b border-border flex items-center justify-between rounded-none">
            <h3 class="text-lg font-bold text-primary flex items-center gap-2">
              <%= lucide_icon "sparkles", class: "w-5 h-5" %>
              千问
              <span class="text-sm font-normal text-muted">qwen3-max</span>
            </h3>
            <div class="flex gap-2">
              <button
                type="button"
                data-action="click->articles#copyResponse"
                data-provider="qwen"
                data-articles-target="copyButtonQwen"
                class="btn-primary btn-sm"
                style="display: none;"
              >
                <%= lucide_icon "copy", class: "w-4 h-4 inline-block mr-1" %>
                复制
              </button>
              <button
                type="button"
                data-action="click->articles#generateDraft"
                data-provider="qwen"
                data-articles-target="draftButtonQwen"
                class="btn-success btn-sm"
                style="display: none;"
              >
                <%= lucide_icon "file-edit", class: "w-4 h-4 inline-block mr-1" %>
                生成初稿
              </button>
            </div>
          </div>
          <div class="card-body">
            <div 
              data-articles-target="responseQwen"
              class="text-secondary text-base leading-relaxed prose prose-sm max-w-none dark:prose-invert min-h-[150px] max-h-[400px] overflow-y-auto"
            >
              <div class="flex items-center gap-2 text-muted">
                <div class="loading-spinner w-4 h-4"></div>
                <span>千问思考中...</span>
              </div>
            </div>
          </div>
        </div>

        <!-- DeepSeek Response -->
        <div class="card card-elevated mb-4 bg-gradient-to-br from-accent/5 to-primary/5 rounded-none">
          <div class="card-header border-b border-border flex items-center justify-between rounded-none">
            <h3 class="text-lg font-bold text-primary flex items-center gap-2">
              <%= lucide_icon "brain", class: "w-5 h-5" %>
              DeepSeek
              <span class="text-sm font-normal text-muted">deepseek-reasoner</span>
            </h3>
            <div class="flex gap-2">
              <button
                type="button"
                data-action="click->articles#copyResponse"
                data-provider="deepseek"
                data-articles-target="copyButtonDeepseek"
                class="btn-primary btn-sm"
                style="display: none;"
              >
                <%= lucide_icon "copy", class: "w-4 h-4 inline-block mr-1" %>
                复制
              </button>
              <button
                type="button"
                data-action="click->articles#generateDraft"
                data-provider="deepseek"
                data-articles-target="draftButtonDeepseek"
                class="btn-success btn-sm"
                style="display: none;"
              >
                <%= lucide_icon "file-edit", class: "w-4 h-4 inline-block mr-1" %>
                生成初稿
              </button>
            </div>
          </div>
          <div class="card-body">
            <div 
              data-articles-target="responseDeepseek"
              class="text-secondary text-base leading-relaxed prose prose-sm max-w-none dark:prose-invert min-h-[150px] max-h-[400px] overflow-y-auto"
            >
              <div class="flex items-center gap-2 text-muted">
                <div class="loading-spinner w-4 h-4"></div>
                <span>DeepSeek 思考中...</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Gemini Response -->
        <div class="card card-elevated mb-4 bg-gradient-to-br from-blue-500/5 to-purple-500/5 rounded-none">
          <div class="card-header border-b border-border flex items-center justify-between rounded-none">
            <h3 class="text-lg font-bold text-primary flex items-center gap-2">
              <%= lucide_icon "gem", class: "w-5 h-5 text-blue-600" %>
              Gemini
              <span class="text-sm font-normal text-muted">gemini-3-flash-preview</span>
            </h3>
            <div class="flex gap-2">
              <button
                type="button"
                data-action="click->articles#copyResponse"
                data-provider="gemini"
                data-articles-target="copyButtonGemini"
                class="btn-primary btn-sm"
                style="display: none;"
              >
                <%= lucide_icon "copy", class: "w-4 h-4 inline-block mr-1" %>
                复制
              </button>
              <button
                type="button"
                data-action="click->articles#generateDraft"
                data-provider="gemini"
                data-articles-target="draftButtonGemini"
                class="btn-success btn-sm"
                style="display: none;"
              >
                <%= lucide_icon "file-edit", class: "w-4 h-4 inline-block mr-1" %>
                生成初稿
              </button>
            </div>
          </div>
          <div class="card-body">
            <div 
              data-articles-target="responseGemini"
              class="text-secondary text-base leading-relaxed prose prose-sm max-w-none dark:prose-invert min-h-[150px] max-h-[400px] overflow-y-auto"
            >
              <div class="flex items-center gap-2 text-muted">
                <div class="loading-spinner w-4 h-4"></div>
                <span>Gemini 思考中...</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Zhipu Response -->
        <div class="card card-elevated mb-4 bg-gradient-to-br from-purple-500/5 to-pink-500/5 rounded-none">
          <div class="card-header border-b border-border flex items-center justify-between rounded-none">
            <h3 class="text-lg font-bold text-primary flex items-center gap-2">
              <%= lucide_icon "zap-off", class: "w-5 h-5 text-purple-600" %>
              智谱
              <span class="text-sm font-normal text-muted">GLM-4.7</span>
            </h3>
            <div class="flex gap-2">
              <button
                type="button"
                data-action="click->articles#copyResponse"
                data-provider="zhipu"
                data-articles-target="copyButtonZhipu"
                class="btn-primary btn-sm"
                style="display: none;"
              >
                <%= lucide_icon "copy", class: "w-4 h-4 inline-block mr-1" %>
                复制
              </button>
              <button
                type="button"
                data-action="click->articles#generateDraft"
                data-provider="zhipu"
                data-articles-target="draftButtonZhipu"
                class="btn-success btn-sm"
                style="display: none;"
              >
                <%= lucide_icon "file-edit", class: "w-4 h-4 inline-block mr-1" %>
                生成初稿
              </button>
            </div>
          </div>
          <div class="card-body">
            <div 
              data-articles-target="responseZhipu"
              class="text-secondary text-base leading-relaxed prose prose-sm max-w-none dark:prose-invert min-h-[150px] max-h-[400px] overflow-y-auto"
            >
              <div class="flex items-center gap-2 text-muted">
                <div class="loading-spinner w-4 h-4"></div>
                <span>智谱思考中...</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Doubao Response - HIDDEN -->
        <div class="card card-elevated mb-4 bg-gradient-to-br from-orange-500/5 to-red-500/5 rounded-none" style="display: none;">
          <div class="card-header border-b border-border flex items-center justify-between rounded-none">
            <h3 class="text-lg font-bold text-primary flex items-center gap-2">
              <%= lucide_icon "flame", class: "w-5 h-5 text-orange-600" %>
              豆包
              <span class="text-sm font-normal text-muted">doubao-seed-1-8-251228</span>
            </h3>
            <div class="flex gap-2">
              <button
                type="button"
                data-action="click->articles#copyResponse"
                data-provider="doubao"
                data-articles-target="copyButtonDoubao"
                class="btn-primary btn-sm"
                style="display: none;"
              >
                <%= lucide_icon "copy", class: "w-4 h-4 inline-block mr-1" %>
                复制
              </button>
              <button
                type="button"
                data-action="click->articles#generateDraft"
                data-provider="doubao"
                data-articles-target="draftButtonDoubao"
                class="btn-success btn-sm"
                style="display: none;"
              >
                <%= lucide_icon "file-edit", class: "w-4 h-4 inline-block mr-1" %>
                生成初稿
              </button>
            </div>
          </div>
          <div class="card-body">
            <div 
              data-articles-target="responseDoubao"
              class="text-secondary text-base leading-relaxed prose prose-sm max-w-none dark:prose-invert min-h-[150px] max-h-[400px] overflow-y-auto"
            >
              <div class="flex items-center gap-2 text-muted">
                <div class="loading-spinner w-4 h-4"></div>
                <span>豆包思考中...</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3: Draft Section -->
      <div data-articles-target="draftSection" style="display: none;" class="mt-8">
        <h2 class="text-2xl font-bold text-primary mb-4 flex items-center gap-2">
          <%= lucide_icon "sparkles", class: "w-6 h-6" %>
          步骤 3：草稿（可编辑）
        </h2>
        
        <div class="card card-elevated p-6 rounded-none">
          <div class="mb-4">
            <div class="flex items-center justify-between mb-3">
              <label class="text-lg font-semibold text-primary">
                使用模型：<span data-articles-target="selectedModelLabel" class="text-secondary"></span>
              </label>
              <div class="flex gap-2">
                <button
                  type="button"
                  data-action="click->articles#saveDraft"
                  class="btn-secondary btn-sm"
                >
                  <%= lucide_icon "save", class: "w-4 h-4 inline-block mr-1" %>
                  保存草稿
                </button>
                <button
                  type="button"
                  data-action="click->articles#copyDraft"
                  class="btn-primary btn-sm"
                >
                  <%= lucide_icon "copy", class: "w-4 h-4 inline-block mr-1" %>
                  复制草稿
                </button>
              </div>
            </div>
            <textarea
              data-articles-target="draftContent"
              class="w-full px-4 py-3 text-base border-2 border-border rounded-none focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all resize-none text-foreground bg-surface"
              rows="20"
              placeholder="草稿生成中..."
            ></textarea>
          </div>
          
          <div class="text-center">
            <button
              type="button"
              data-action="click->articles#showStyleSelection"
              class="btn-primary btn-lg px-12"
            >
              <%= lucide_icon "arrow-right", class: "w-5 h-5 inline-block mr-2" %>
              继续生成定稿
            </button>
          </div>
        </div>
      </div>

      <!-- Step 4: Final Article with Style Selection -->
      <div data-articles-target="finalSection" style="display: none;" class="mt-8">
        <h2 class="text-2xl font-bold text-primary mb-4 flex items-center gap-2">
          <%= lucide_icon "sparkles", class: "w-6 h-6" %>
          步骤 4：选择风格 & 定稿
        </h2>
        
        <!-- Style Selection -->
        <div class="grid md:grid-cols-3 gap-4 mb-6">
          <!-- 史蒂芬·平克 -->
          <button
            type="button"
            data-action="click->articles#generateFinal"
            data-style="pinker"
            class="card card-elevated p-6 hover:shadow-lg transition-all text-left group rounded-none"
          >
            <div class="flex items-center gap-3 mb-3">
              <%= lucide_icon "brain", class: "w-8 h-8 text-primary" %>
              <h3 class="text-xl font-bold text-primary">史蒂芬·平克</h3>
            </div>
            <p class="text-secondary text-sm leading-relaxed">
              理性清晰、善用类比、数据支撑、优雅幽默、结构清晰的科学写作风格
            </p>
          </button>
          
          <!-- 罗振宇 -->
          <button
            type="button"
            data-action="click->articles#generateFinal"
            data-style="luozhenyu"
            class="card card-elevated p-6 hover:shadow-lg transition-all text-left group rounded-none"
          >
            <div class="flex items-center gap-3 mb-3">
              <img src="https://backend-prod-hjlerckip39sk4no.s3-accelerate.amazonaws.com/images/2026/01/15/0194e09c-901f-7b99-bb46-e5b93b676708/icon_-192_1b61556a.png" alt="罗振宇" class="w-8 h-8 rounded-full object-cover" />
              <h3 class="text-xl font-bold text-primary">罗振宇</h3>
            </div>
            <p class="text-secondary text-sm leading-relaxed">
              开门见山、故事化表达、金句频出、实用导向、降维打击的知识传播风格
            </p>
          </button>
          
          <!-- 王小波 -->
          <button
            type="button"
            data-action="click->articles#generateFinal"
            data-style="wangxiaobo"
            class="card card-elevated p-6 hover:shadow-lg transition-all text-left group rounded-none"
          >
            <div class="flex items-center gap-3 mb-3">
              <%= image_tag "wangxiaobo-avatar.png", class: "w-8 h-8 rounded-full object-cover" %>
              <h3 class="text-xl font-bold text-primary">王小波</h3>
            </div>
            <p class="text-secondary text-sm leading-relaxed">
              荒诞幽默、理性反叛、生活化哲思、真诚直白、跳跃思维的杂文风格
            </p>
          </button>
        </div>
        
        <!-- Final Article Display -->
        <div data-articles-target="finalArticleContainer" style="display: none;">
          <div class="card card-elevated p-6 rounded-none">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-xl font-bold text-primary flex items-center gap-2">
                <%= lucide_icon "file-check", class: "w-5 h-5" %>
                定稿结果（可编辑）
                <span class="text-base font-normal text-muted">（风格：<span data-articles-target="finalStyleLabel"></span>）</span>
              </h3>
              <div class="flex gap-2">
                <button
                  type="button"
                  data-action="click->articles#saveFinal"
                  class="btn-secondary btn-sm"
                >
                  <%= lucide_icon "save", class: "w-4 h-4 inline-block mr-1" %>
                  保存定稿
                </button>
                <button
                  type="button"
                  data-action="click->articles#copyFinal"
                  class="btn-primary btn-sm"
                >
                  <%= lucide_icon "copy", class: "w-4 h-4 inline-block mr-1" %>
                  复制定稿
                </button>
              </div>
            </div>
            
            <!-- Hidden div for streaming markdown display -->
            <div 
              data-articles-target="finalArticlePreview"
              class="hidden"
            >
            </div>
            
            <!-- Editable textarea for final content -->
            <textarea
              data-articles-target="finalArticle"
              class="w-full px-4 py-3 text-base border-2 border-border rounded-none focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all resize-none text-foreground bg-surface"
              rows="20"
              placeholder="定稿生成中..."
            ></textarea>
          </div>
        </div>
      </div>

      <!-- Step 5: Generate Viral Title -->
      <div data-articles-target="titleSection" style="display: none;" class="mt-8">
        <h2 class="text-2xl font-bold text-primary mb-4 flex items-center gap-2">
          <%= lucide_icon "sparkles", class: "w-6 h-6" %>
          步骤 5：选择风格 & 生成爆款标题
        </h2>
        
        <!-- Title Style Selection -->
        <div class="grid md:grid-cols-2 gap-4 mb-6">
          <!-- 迷蒙体 -->
          <button
            type="button"
            data-action="click->articles#generateTitle"
            data-style="mimeng"
            class="card card-elevated p-6 hover:shadow-lg transition-all text-left group rounded-none"
          >
            <div class="flex items-center gap-3 mb-3">
              <%= lucide_icon "flame", class: "w-8 h-8 text-primary" %>
              <h3 class="text-xl font-bold text-primary">迷蒙体</h3>
            </div>
            <p class="text-secondary text-sm leading-relaxed">
              情绪共鸣、制造对比、身份代入、悬念设置的爆款标题风格
            </p>
          </button>
          
          <!-- 普通风格 -->
          <button
            type="button"
            data-action="click->articles#generateTitle"
            data-style="normal"
            class="card card-elevated p-6 hover:shadow-lg transition-all text-left group rounded-none"
          >
            <div class="flex items-center gap-3 mb-3">
              <%= lucide_icon "type", class: "w-8 h-8 text-primary" %>
              <h3 class="text-xl font-bold text-primary">普通风格</h3>
            </div>
            <p class="text-secondary text-sm leading-relaxed">
              简洁、准确、有吸引力的常规标题风格
            </p>
          </button>
        </div>
        
        <!-- Title Display -->
        <div data-articles-target="titleContainer" style="display: none;">
          <div class="card card-elevated p-6 rounded-none">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-xl font-bold text-primary flex items-center gap-2">
                <%= lucide_icon "heading", class: "w-5 h-5" %>
                标题建议
                <span class="text-base font-normal text-muted">（风格：<span data-articles-target="titleStyleLabel"></span>）</span>
              </h3>
              <div class="flex gap-2">
                <button
                  type="button"
                  data-action="click->articles#copyAllTitles"
                  class="btn-primary btn-sm"
                >
                  <%= lucide_icon "copy", class: "w-4 h-4 inline-block mr-1" %>
                  复制全部
                </button>
              </div>
            </div>
            
            <!-- Title list display -->
            <div 
              data-articles-target="titleList"
              class="space-y-3 text-foreground text-lg leading-relaxed"
            >
              <p class="text-muted">标题生成中...</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 6: Generate Variant -->
      <div data-articles-target="variantSection" style="display: none;" class="mt-8">
        <h2 class="text-2xl font-bold text-primary mb-4 flex items-center gap-2">
          <%= lucide_icon "sparkles", class: "w-6 h-6" %>
          步骤 6：选择变体风格
        </h2>
        
        <!-- Variant Style Selection -->
        <div class="grid md:grid-cols-2 gap-4 mb-6">
          <!-- 小绿书 -->
          <button
            data-action="click->articles#generateVariant"
            data-style="xiaolvshu"
            class="card card-elevated p-6 hover:shadow-xl transition-all cursor-pointer text-left group rounded-none"
          >
            <div class="flex items-start gap-4">
              <div class="text-4xl">🌿</div>
              <div class="flex-1">
                <h3 class="text-xl font-bold text-primary mb-2 group-hover:text-accent transition-colors">小绿书</h3>
                <p class="text-sm text-muted mb-2">纯文本风格，简洁直白</p>
                <ul class="text-xs text-muted space-y-1">
                  <li>• 1000字以内，精简表达</li>
                  <li>• 无Markdown格式，纯文本</li>
                  <li>• 口语化，易于阅读</li>
                </ul>
              </div>
            </div>
          </button>
          
          <!-- 小红书 -->
          <button
            data-action="click->articles#generateVariant"
            data-style="xiaohongshu"
            class="card card-elevated p-6 hover:shadow-xl transition-all cursor-pointer text-left group rounded-none"
          >
            <div class="flex items-start gap-4">
              <div class="text-4xl">📝</div>
              <div class="flex-1">
                <h3 class="text-xl font-bold text-primary mb-2 group-hover:text-accent transition-colors">小红书</h3>
                <p class="text-sm text-muted mb-2">爆款笔记风格，互动性强</p>
                <ul class="text-xs text-muted space-y-1">
                  <li>• Emoji点缀，视觉吸引</li>
                  <li>• 口语化表达，亲切感</li>
                  <li>• 干货标签，易于分享</li>
                </ul>
              </div>
            </div>
          </button>
        </div>
        
        <!-- Variant Display -->
        <div data-articles-target="variantContainer" style="display: none;">
          <div class="card card-elevated p-6 rounded-none">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-bold text-primary flex items-center gap-2">
                <%= lucide_icon "file-text", class: "w-5 h-5" %>
                生成的变体
                <span class="badge badge-info" data-articles-target="variantStyleLabel">小绿书</span>
              </h3>
              <div class="flex gap-2">
                <button
                  type="button"
                  data-action="click->articles#saveVariant"
                  class="btn-primary btn-sm"
                >
                  <%= lucide_icon "save", class: "w-4 h-4 inline-block mr-1" %>
                  保存变体
                </button>
                <button
                  type="button"
                  data-action="click->articles#copyVariant"
                  class="btn-secondary btn-sm"
                >
                  <%= lucide_icon "copy", class: "w-4 h-4 inline-block mr-1" %>
                  复制变体
                </button>
              </div>
            </div>
            
            <!-- Editable textarea for variant -->
            <textarea
              data-articles-target="variantText"
              class="w-full px-4 py-3 text-base border-2 border-border rounded-none focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all resize-none text-foreground bg-surface leading-relaxed"
              rows="15"
              placeholder="变体生成中..."
            ></textarea>
          </div>
        </div>
      </div>

      <!-- History Sidebar -->
      <div 
        data-articles-target="historyOverlay"
        class="fixed inset-0 bg-black/50 z-50 transition-opacity duration-300"
        style="display: none; opacity: 0;"
        data-action="click->articles#closeHistory"
      ></div>

      <div 
        data-articles-target="historySidebar"
        class="fixed top-0 right-0 h-full w-full md:w-96 bg-surface shadow-2xl z-50 transform transition-transform duration-300"
        style="display: none; transform: translateX(100%);"
      >
        <!-- Sidebar Header -->
        <div class="flex items-center justify-between p-6 border-b border-border">
          <h2 class="text-2xl font-bold text-primary flex items-center gap-2">
            <%= lucide_icon "history", class: "w-6 h-6" %>
            历史文章
          </h2>
          <button
            type="button"
            data-action="click->articles#closeHistory"
            class="btn-secondary btn-sm"
          >
            <%= lucide_icon "x", class: "w-5 h-5" %>
          </button>
        </div>
        
        <!-- Sidebar Content -->
        <div class="overflow-y-auto h-[calc(100%-160px)]">
          <div data-articles-target="historyList" class="p-4">
            <div class="flex items-center justify-center py-12 text-muted">
              <div class="loading-spinner w-6 h-6 mr-2"></div>
              加载中...
            </div>
          </div>
        </div>

        <!-- Sidebar Footer -->
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-border bg-surface">
          <%= link_to my_books_path, class: "btn-primary w-full" do %>
            <%= lucide_icon "book", class: "w-5 h-5 inline-block mr-2" %>
            我的书籍
          <% end %>
        </div>

      </div>
    </div>


  </div>
</div>

<style>
  /* Recording animation */
  [data-voice-recorder-target="micButton"].recording {
    animation: pulse 1.5s ease-in-out infinite;
    background: hsl(var(--color-danger));
  }

  @keyframes pulse {
    0%, 100% {
      transform: scale(1);
      box-shadow: 0 0 0 0 hsl(var(--color-danger) / 0.7);
    }
    50% {
      transform: scale(1.05);
      box-shadow: 0 0 0 20px hsl(var(--color-danger) / 0);
    }
  }

  /* Loading spinner */
  .loading-spinner {
    border: 2px solid hsl(var(--color-border));
    border-top-color: hsl(var(--color-primary));
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }
</style>
